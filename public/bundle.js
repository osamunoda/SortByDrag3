!function(t){var e={};function s(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(i,n,function(e){return t[e]}.bind(null,n));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=1)}([function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getPanelIndex=function(t,e,s,i,n,h,r){const o=e-h,a=s-r;return t*Math.floor(a/n)+Math.floor(o/i)},e.calcPositions=function(t,e,s,i){const n=[];for(let h=0;h<i;h++){const i=h%s*t,r=Math.floor(h/s)*e;n.push({x:i,y:r})}return n},function(t){t[t.lt=0]="lt",t[t.rt=1]="rt",t[t.lb=2]="lb",t[t.rb=3]="rb"}(e.corners||(e.corners={})),e.checkOutOfBound=function(t,e,s=0){return t.x,t.y,t.x>e.right-5||t.x<e.left+5||t.y<e.top+s+5||t.y>e.bottom+s-5},e.checkRightEdge=function(t,e){return!!t.touches&&e.right-t.touches[0].clientX<40},e.checkBottomEdge=function(t,e){if(t.touches)return e-t.touches[0].clientY<40},e.checkMultiTouch=function(t){return!!t.touches&&t.touches.length>1}},function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=i(s(2)),h=i(s(4)),r=i(s(5)),o=[["1","1","Main-1","aaaaa","color","pink"],["2","2","Main-2","bbbbb","color","pink"],["3","3","Main-3","ccccc","color","pink"],["4","4","Main-4","ddddd","color","pink"],["5","5","Main-5","eeeee","color","pink"],["6","6","Main-6","fffff","color","pink"],["7","7","Main-7","ggggg","color","pink"]].map(t=>{return{id:t[0],text1:t[2],text2:t[3],type:t[5],background:t[4]}}),a={columns:Number.isNaN(Number("__COLUMNS__"))?1:Number("__COLUMNS__"),cellHeight:200,frameWidth:window.innerWidth,cards:o},l={width:80,height:a.cellHeight},c=new n.default(a.columns,a.frameWidth,a.cellHeight,a.cards),d=new r.default(l.width,l.height),u=document.getElementById("root");u&&(u.appendChild(c),c.appendChild(d),document.body.style.margin="0"),new h.default(c).setButton(d)},function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=i(s(3)),h=s(0);class r extends HTMLElement{constructor(t,e,s,i){super(),this._cards=i,this._columns=t,this._frameWidth=e,this._cellHeight=s,this._cellWidth=this._frameWidth/this._columns;const n=this.attachShadow({mode:"closed"});n.innerHTML=`<style>\n        :host{\n            --width:${this._frameWidth};\n        }\n        .frame{\n            overflow-x:hidden;\n            width:calc(1px*var(--width));\n            display:flex;\n            flex-wrap:wrap;\n        }\n        </style><div class="frame"><slot></slot></div>`,this._frame=n.querySelector("div")||new HTMLDivElement,this._shadow=n}getFrame(){return this._frame}connectedCallback(){this._cards.forEach(t=>{const e=new n.default(this._cellWidth,this._cellHeight,t.background,t.text1,t.text2,t.id);this._frame&&this._frame.appendChild(e)})}static get observedAttributes(){return[]}getCardWidth(){return this._cellWidth}getCardHeight(){return this._cellHeight}getPositions(t){return h.calcPositions(this._cellWidth,this._cellHeight,this._columns,t)}getFrameWidth(){return this._frameWidth}getColumns(){return this._columns}attributeChangedCallback(t,e,s){}}e.default=r,customElements.define("draggable-frame",r)},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i extends HTMLElement{constructor(t,e,s,i,n,h){super(),this._id=h,this._width=t||200,this._height=e||100;const r=s.length>30?"base64":"";this._background="base64"===r?`url(data:image/jpeg;base64,${s})`:s||"pink",this._text1=i||"Main Text",this._text2=n||"Sub Text";const o=this.attachShadow({mode:"closed"});o.innerHTML=`<style>\n        :host{\n            margin:0;padding:0;\n            --width:${this._width};\n            --height:${this._height};\n            --background:${this._background};\n        }\n        #main {\n            font-family:sans-serif;\n            box-sizing:border-box;\n            background: var(--background);\n            background-size: 100% 100%;\n            width:calc(1px*var(--width));\n            height:calc(1px*var(--height));\n            position:relative;\n            border:1px solid #ccc;\n            display:flex;\n            justify-content:center;\n            align-items:center;\n            flex-direction:column;\n            opacity:0.8\n        }\n        </style>\n        <div id="main">\n            <h1>${this._text1}</h1>\n            <p>${this._text2}</p>\n        </div>\n        `,this._mainText=o.querySelector("h1"),this._subText=o.querySelector("p"),this._shadow=o}static get observedAttributes(){return["data-text1","data-text2","data-background","data-width","data-height"]}getID(){return this._id}attributeChangedCallback(t,e,s){if("data-text1"===t)this._text1=s,this._mainText&&(this._mainText.innerText=s);else if("data-text2"===t)this._text2=s,this._subText&&(this._subText.innerText=s);else if("data-background"===t){if(this._background=s,this._shadow){this._shadow.styleSheets[0].rules[0].style.setProperty("--background",s)}}else if("data-width"===t){if(this._width=Number(s),this._shadow){this._shadow.styleSheets[0].rules[0].style.setProperty("--width",s)}}else if("data-height"===t&&(this._height=Number(s),this._shadow)){this._shadow.styleSheets[0].rules[0].style.setProperty("--height",s)}}connectedCallback(){this.dataset.text1=this._text1,this.dataset.text2=this._text2,this.dataset.background=this._background,this.dataset.width=this._width+"",this.dataset.height=this._height+"",this.setAttribute("id",this._id)}}e.default=i,customElements.define("draggable-card",i)},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0);e.default=class{constructor(t){this.scrollY=Number.isNaN(Number("__SORTSCROLL__"))?0:Number("__SORTSCROLL__"),t&&this._init(t)}clickHandler(t){}mouseDownHandler(t){if(t.stopPropagation(),t.preventDefault(),t.target&&t.target instanceof HTMLElement&&("DRAGGABLE-CARD"===t.target.tagName||"BUTTON-PANEL"===t.target.tagName)){this._target=t.target,this.down=!0,this.startX=t.pageX,this.startY=t.pageY;const e=t.target.getBoundingClientRect();if(this.startLeft=e.left,this.startTop=e.top,this.startTime=Date.now(),this.scrollY=window.scrollY,this.dragDirection=0,this.startPanelsOrder=this.getPanelsIDList(),this.buttonMode)return this.buttonMode="",setTimeout(()=>{this._prevTarget&&(this._buttonPanel&&(this._buttonPanel.style.display="none",this._buttonPanel.style.opacity="0"),this.setBasicStyle(this._prevTarget),this._prevTarget.style.transform="none")},1e3),void this.mouseUpHandler(t);if(this.multiTouch);else{this.setSelectedStyle(this._target),1!==this.columns&&(this.timer=setTimeout(()=>{this._target&&(location.href="fmp://$/__SORTDB__?script=sortByDrag_longPress&$selectedID="+this._target.id)},1e3)),this._target.style.transition="none";const t=i.getPanelIndex(this.columns,this.startX,this.startY,this.panelWidth,this.panelHeight,this.Ox,this.Oy);this.startIndex=t,this.notSelectedPositions=this.positions.filter((e,s)=>s!=t),this.notSelectedPanels=this.panels.filter((e,s)=>s!=t)}}}touchStartHandler(t){if(this.multiTouch=i.checkMultiTouch(t)||i.checkRightEdge(t,this._frame.getBoundingClientRect())||i.checkBottomEdge(t,this._frame.getBoundingClientRect().height),!this.multiTouch&&(t.stopPropagation(),t.preventDefault(),t.target&&t.target instanceof HTMLElement&&("DRAGGABLE-CARD"===t.target.tagName||"BUTTON-PANEL"===t.target.tagName))){this._target=t.target,this.down=!0,this.startX=t.touches[0].pageX,this.startY=t.touches[0].pageY;const e=t.target.getBoundingClientRect();if(this.startLeft=e.left,this.startTop=e.top,this.startTime=Date.now(),this.scrollY=window.scrollY,this.dragDirection=0,this.buttonMode)return this.buttonMode="",this._buttonPanel&&(this._buttonPanel.style.display="none",this._buttonPanel.style.opacity="0"),setTimeout(()=>{this._prevTarget&&(this.setBasicStyle(this._prevTarget),this._prevTarget.style.transform="none")},0),void this.touchEndHandler(t);if(this.multiTouch=i.checkMultiTouch(t)||i.checkRightEdge(t,this.bounding)||i.checkBottomEdge(t,window.innerHeight),this.multiTouch);else{this.setSelectedStyle(this._target),1!==this.columns&&(this.timer=setTimeout(()=>{this._target&&(location.href="fmp://$/__SORTDB__?script=sortByDrag_longPress&$selectedID="+this._target.id)},1e3)),this._target.style.transition="none";const t=i.getPanelIndex(this.columns,this.startX,this.startY,this.panelWidth,this.panelHeight,this.Ox,this.Oy);this.startIndex=t,this.notSelectedPositions=this.positions.filter((e,s)=>s!=t),this.notSelectedPanels=this.panels.filter((e,s)=>s!=t)}}}mouseMoveHandler(t){if(t.stopPropagation(),t.preventDefault(),t.target&&t.target instanceof HTMLElement&&"DRAGGABLE-CARD"===t.target.tagName&&this.down&&t.target===this._target){const e={x:t.pageX,y:t.pageY};if(i.checkOutOfBound(e,this.bounding,0))return void this.mouseUpHandler(t);if(this.multiTouch);else{this.currentX=t.pageX,this.currentY=t.pageY,this.scrollY=window.scrollY;const e=Math.abs(this.currentX-this.startX),s=Math.abs(this.currentY-this.startY);1!==this.columns?this.startTime&&Math.abs(this.startX-this.currentX)<20&&Math.abs(this.startY-this.currentY)<20?Date.now()-this.startTime>1100&&(this.startTime=null,t.target.style.boxShadow="none"):(this.startTime=null,this.timer&&clearTimeout(this.timer)):0===this.dragDirection&&(s>20&&e<10?this.dragDirection=1:e>20&&s<10&&(this.dragDirection=-1));let n=i.getPanelIndex(this.columns,this.currentX,this.currentY,this.panelWidth,this.panelHeight,this.Ox,this.Oy);n>this.panels.length-1&&this.panels.length;const h=this.notSelectedPositions.slice();h.splice(n,0,{x:0,y:0});const r=this.notSelectedPanels.slice();r.splice(n,0,t.target);const o=this;r.forEach((e,s)=>{let i=0,n=0;e==t.target?(i=o.currentX-o.startX,n=o.currentY-o.startY,-1===this.dragDirection?(n=0,i>this.buttonWidth?i=this.buttonWidth:i<-1*this.buttonWidth&&(i=-1*this.buttonWidth)):1===this.dragDirection&&(i=0)):(i=o.positions[s].x-h[s].x,n=o.positions[s].y-h[s].y),e.style.transform="translate("+i+"px,"+n+"px)",window.innerHeight-t.clientY<20?window.scrollBy(0,2):t.clientY<20&&window.scrollBy(0,-2),1===this.columns&&Math.abs(i)>=this.buttonWidth&&(i>=this.buttonWidth?this.buttonMode="info":i<=-1*this.buttonWidth&&(this.buttonMode="delete"),this.mouseUpHandler(t))})}}}touchMoveHandler(t){if(!this.multiTouch&&(t.stopPropagation(),t.preventDefault(),t.target&&t.target instanceof HTMLElement&&"DRAGGABLE-CARD"===t.target.tagName&&this.down&&t.target===this._target)){const e={x:t.changedTouches[0].pageX,y:t.changedTouches[0].pageY};if(i.checkOutOfBound(e,this.bounding,0))return void this.touchEndHandler(t);if(this.multiTouch);else{this.currentX=t.changedTouches[0].pageX,this.currentY=t.changedTouches[0].pageY,this.scrollY=window.scrollY;const e=Math.abs(this.currentX-this.startX),s=Math.abs(this.currentY-this.startY);1!==this.columns?this.startTime&&Math.abs(this.startX-this.currentX)<20&&Math.abs(this.startY-this.currentY)<20?Date.now()-this.startTime>1100&&(this.startTime=null,t.target.style.boxShadow="none"):(this.startTime=null,this.timer&&clearTimeout(this.timer)):0===this.dragDirection&&(s>20&&e<10?this.dragDirection=1:e>20&&s<10&&(this.dragDirection=-1));let n=i.getPanelIndex(this.columns,this.currentX,this.currentY,this.panelWidth,this.panelHeight,this.Ox,this.Oy);n>this.panels.length-1&&this.panels.length;const h=this.notSelectedPositions.slice();h.splice(n,0,{x:0,y:0});const r=this.notSelectedPanels.slice();r.splice(n,0,t.target);const o=this;r.forEach((e,s)=>{let i=0,n=0;e==t.target?(i=o.currentX-o.startX,n=o.currentY-o.startY,-1===this.dragDirection?(n=0,i>this.buttonWidth?i=this.buttonWidth:i<-1*this.buttonWidth&&(i=-1*this.buttonWidth)):1===this.dragDirection&&(i=0)):(i=o.positions[s].x-h[s].x,n=o.positions[s].y-h[s].y),e.style.transform="translate("+i+"px,"+n+"px)",window.innerHeight-t.changedTouches[0].clientY<70?window.scrollBy(0,2):t.changedTouches[0].clientY<70&&window.scrollBy(0,-2),1===this.columns&&Math.abs(i)>=this.buttonWidth&&(i>=this.buttonWidth?this.buttonMode="info":i<=-1*this.buttonWidth&&(this.buttonMode="delete"),this.touchEndHandler(t))})}}}mouseUpHandler(t){if(t.stopPropagation(),t.preventDefault(),t.target&&t.target instanceof HTMLElement&&"DRAGGABLE-CARD"===t.target.tagName&&this.down&&t.target===this._target)if(this._prevTarget=this._target,this.currentX=t.pageX,this.currentY=t.pageY,this.startTime=null,this.setBasicStyle(this._target),this._target.style.transition="none",this.timer&&clearTimeout(this.timer),this.multiTouch);else{if(!this.down)return;if(!this._frame)return;let e=i.getPanelIndex(this.columns,this.currentX,this.currentY,this.panelWidth,this.panelHeight,this.Ox,this.Oy);e>this.panels.length-1&&(e=this.panels.length-1);const s=this.positions[e].x-this.positions[this.startIndex].x,n=this.positions[e].y-this.positions[this.startIndex].y;t.target.style.transform="translate("+s+"px,"+n+"px)",this.down=!1,this._target=null,this.dragDirection=0,this.panels.forEach(t=>{t.style.transition="none",t.style.transform="none"}),this._frame.insertBefore(t.target,this.panels[e+(e>this.startIndex?1:0)]),this.panels=Array.from(this._frame.querySelectorAll("draggable-card")),setTimeout(()=>{const t=[];this.panels.forEach(e=>{this.setBasicStyle(e),t.push(e.id)});const e=t.join("_");this.startPanelsOrder!==e&&(location.href="fmp://$/__SORTDB__?script=sortByDrag_interaction&$scroll="+document.body.scrollTop+"&$panelOrder="+e)},0),this.buttonMode&&this.showButton(this.buttonMode,e)}}touchEndHandler(t){if(!this.multiTouch&&(t.stopPropagation(),t.preventDefault(),t.target&&t.target instanceof HTMLElement&&"DRAGGABLE-CARD"===t.target.tagName&&this.down&&t.target===this._target))if(this._prevTarget=this._target,this.currentX=t.changedTouches[0].pageX,this.currentY=t.changedTouches[0].pageY,this.startTime=null,this.setBasicStyle(this._target),this._target.style.transition="none",this.timer&&clearTimeout(this.timer),this.multiTouch);else{if(!this.down)return;if(!this._frame)return;let e=i.getPanelIndex(this.columns,this.currentX,this.currentY,this.panelWidth,this.panelHeight,this.Ox,this.Oy);e>this.panels.length-1&&(e=this.panels.length-1);const s=this.positions[e].x-this.positions[this.startIndex].x,n=this.positions[e].y-this.positions[this.startIndex].y;t.target.style.transform="translate("+s+"px,"+n+"px)",this.down=!1,this._target=null,this.dragDirection=0,this.panels.forEach(t=>{t.style.transition="none",t.style.transform="none"}),this._frame.insertBefore(t.target,this.panels[e+(e>this.startIndex?1:0)]),this.panels=Array.from(this._frame.querySelectorAll("draggable-card")),setTimeout(()=>{const t=[];this.panels.forEach(e=>{this.setBasicStyle(e),t.push(e.id)});const e=t.join("_");this.startPanelsOrder!==e&&(location.href="fmp://$/__SORTDB__?script=sortByDrag_interaction&$scroll="+document.body.scrollTop+"&$panelOrder="+e)},0),this.buttonMode&&this.showButton(this.buttonMode,e)}}_init(t){this.gatherInformationFromDraggableFrame(t),this.multiTouch=!1,this.setupBasicCardBehavior(),this.setupHandlers(),document.body.scrollTo(0,this.scrollY)}gatherInformationFromDraggableFrame(t){if(!t)return;if(this._frame=t.getFrame(),!this._frame)return;const e=this._frame.getBoundingClientRect();this.bounding=e,this.Ox=e.left,this.Oy=e.top,this.panels=Array.from(this._frame.querySelectorAll("draggable-card")),this.positions=t.getPositions(this.panels.length),this.panelWidth=t.getCardWidth(),this.panelHeight=t.getCardHeight(),this.frameWidth=t.getFrameWidth(),this.columns=t.getColumns()}setupHandlers(){this._frame&&(this._frame.addEventListener("mousedown",this.mouseDownHandler.bind(this)),this._frame.addEventListener("mousemove",this.mouseMoveHandler.bind(this)),this._frame.addEventListener("mouseup",this.mouseUpHandler.bind(this)),this._frame.addEventListener("mouseout",this.mouseUpHandler.bind(this)),this._frame.addEventListener("mouseclick",this.clickHandler.bind(this)),this._frame.addEventListener("touchstart",this.touchStartHandler.bind(this)),this._frame.addEventListener("touchmove",this.touchMoveHandler.bind(this)),this._frame.addEventListener("touchend",this.touchEndHandler.bind(this)))}setupBasicCardBehavior(){this.panels&&this.panels.forEach(t=>{this.setBasicStyle(t)})}setSelectedStyle(t){t.style.boxShadow="inset 0 0 50px",t.style.zIndex="10",t.style.transition="none"}setBasicStyle(t){t.style.boxShadow="none",t.style.zIndex="1",t.style.transition="0.3s"}setButton(t){this._buttonPanel=document.querySelector("button-panel"),this.buttonWidth=t.getWidth()}showButton(t,e){this._prevTarget&&(this._prevTarget.style.transform="info"===t?`translateX(${this.buttonWidth}px)`:`translateX(-${this.buttonWidth}px)`,this._buttonPanel&&(this._buttonPanel.style.left="info"===t?"0":this.frameWidth-this.buttonWidth+"px",this._buttonPanel.style.top=e*this.panelHeight+"px",this._buttonPanel.changeIcon(t),this._buttonPanel.style.transition="0.6s",this._buttonPanel.style.display="flex",setTimeout(()=>{this._buttonPanel&&(this._buttonPanel.style.opacity="1")})))}isClick(t,e,s,i){return Math.abs(t-s)<5&&Math.abs(e-i)<5}getPanelsIDList(){if(this._frame){this.panels=Array.from(this._frame.querySelectorAll("draggable-card"));const t=[];return this.panels.forEach(e=>{t.push(e.id)}),t.join("_")}return null}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i extends HTMLElement{constructor(t,e,s){super(),this.width=t,this.height=e,this.currentLabel="info",this.labels={},s&&(this.text=s.label,this.icon=s.code,this.handler=s.handler,this.currentLabel=this.text,s.option&&(this.option=s.option),this.labels[s.label]=s);const i={label:"info",code:'<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" stroke-width="10" viewBox="0 0 24 24" fill="white"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg>',background:"rgb(0,0,160)",color:"white",handler:()=>{location.href="fmp://$/__SORTDB__?script=sortByDrag_info"}};this.labels.info=i;const n={label:"delete",code:'<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="white"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/></svg>',background:"rgb(160,0,0)",color:"white",handler:()=>{location.href="fmp://$/__SORTDB__?script=sortByDrag_delete"}};this.labels.delete=n,this.svgIcon=this.labels[this.currentLabel];const h=this.attachShadow({mode:"closed"});h.innerHTML=`<style>\n                :host{\n                    margin:0;\n                    --bg-color:${this.svgIcon.background};\n                    border-radius:4px;\n                    transition:0.3s;\n                    opacity:0;\n                    position:absolute;\n                    box-sizing:border-box;\n                    display:none;\n                    justify-content:center;\n                    align-items:center;\n                    background:var(--bg-color);\n                    color:white;\n                    width:${this.width}px;\n                    height:${this.height}px;\n                }\n                div{\n                    font-weight:bold;\n                    font:1rem sans-serif;\n                    text-align:center;\n                }\n            </style>\n            <div class="buttonPanel">\n                ${this.svgIcon.code}\n                <div>${this.text}</div>\n            </div>\n        `,this._shadow=h,this._svg=h.querySelector(".buttonPanel")}connectedCallback(){this.onmousedown=this.svgIcon.handler,this.ontouchend=this.svgIcon.handler}attributeChangedCallback(){}static get observedAttributes(){return[]}getWidth(){return this.width}changeIcon(t){if(this.svgIcon=this.labels[t],this._shadow){this._shadow.styleSheets[0].rules[0].style.setProperty("--bg-color",this.svgIcon.background),this._svg&&(this._svg.innerHTML=`${this.svgIcon.code}\n                <div>${this.svgIcon.label}</div>`,this.onmousedown=this.svgIcon.handler,this.ontouchend=this.svgIcon.handler)}}addIcon(t){this.labels[t.label]=t}}e.default=i,customElements.define("button-panel",i)}]);